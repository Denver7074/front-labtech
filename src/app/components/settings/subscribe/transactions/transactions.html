<mat-card class="transactions-card">
  <div class="table-container">
    <table mat-table [dataSource]="transactions()" class="transactions-table" aria-describedby="Таблица транзакций">

      <!-- ID Column -->
      <ng-container matColumnDef="index">
        <th mat-header-cell *matHeaderCellDef>№</th>
        <td mat-cell *matCellDef="let tx; let i = index">
          {{ currentPage() * pageSize() + i + 1 }}
        </td>
      </ng-container>

      <!-- Amount Column -->
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Сумма</th>
        <td mat-cell *matCellDef="let tx">{{ tx.amount | number:'1.2-2' }} ₽</td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Статус</th>
        <td mat-cell *matCellDef="let tx">
          <span class="status-badge status-{{ tx.status.toLowerCase() }}">
            {{ getValue(tx.status, TRANSACTION_STATUS_LABELS) }}
          </span>
        </td>
      </ng-container>

      <!-- Period Column -->
      <ng-container matColumnDef="period">
        <th mat-header-cell *matHeaderCellDef>Период действия</th>
        <td mat-cell *matCellDef="let tx">{{ getValue(tx.period, PERIOD_LABELS) }}</td>
      </ng-container>

      <ng-container matColumnDef="subscribe">
        <th mat-header-cell *matHeaderCellDef>Тип подписки</th>
        <td mat-cell *matCellDef="let tx">{{ tariffPlanTypeMap()?.get(tx.tariffPlanTypeId) }}</td>
      </ng-container>

      <!-- Created At Column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Создано</th>
        <td mat-cell *matCellDef="let tx">{{ tx.createdAt | date:'dd.MM.yyyy HH:mm' }}</td>
      </ng-container>

      <!-- Updated At Column -->
      <ng-container matColumnDef="updatedAt">
        <th mat-header-cell *matHeaderCellDef>Обновлено</th>
        <td mat-cell *matCellDef="let tx">{{ tx.updatedAt | date:'dd.MM.yyyy HH:mm' }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Обновить статус</th>
        <td mat-cell *matCellDef="let tx">
          @if (tx.status !== 'DONE' && tx.status !== 'FAILED') {
            <button
              mat-icon-button
              color="primary"
              (click)="checkStatus(tx.id)"
              [disabled]="isChecking[tx.id]"
              matTooltip="Проверить статус"
            >
              @if (isChecking[tx.id]) {
                <app-loader>Обновление статуса транзакции</app-loader>
              } @else {
                <mat-icon>sync</mat-icon>
              }
            </button>
          } @else {
            @if (tx.status === 'DONE') {
              <mat-icon color="primary" matTooltip="Успешная операция">check_circle</mat-icon>
            } @else if (tx.status === 'FAILED') {
              <mat-icon color="warn" matTooltip="Операция не выполнена">error</mat-icon>
            }
          }
        </td>
      </ng-container>

      <!-- Define the header and data rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Empty row when no data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          Нет данных о транзакциях.
        </td>
      </tr>
    </table>
  </div>

  <!-- Paginator -->
  <mat-paginator
    [length]="totalItems()"
    [pageIndex]="currentPage()"
    [pageSize]="pageSize()"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPageChange($event)"
    aria-label="Пагинация транзакций"
  >
  </mat-paginator>
</mat-card>
