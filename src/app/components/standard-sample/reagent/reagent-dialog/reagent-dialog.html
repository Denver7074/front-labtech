<div class="dialog-form">
  <div mat-dialog-title class="dialog-header">
    <div class="header-content">
      <mat-icon>inventory_2</mat-icon>
      <h2 class="title">{{ title }}</h2>
    </div>
    <p class="subtitle">Заполните информацию о реактиве</p>
  </div>

  <mat-dialog-content class="dialog-content">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form">


      <div class="form-fields">
        <!-- Наименование -->
        <mat-form-field appearance="outline">
          <mat-label>Наименование</mat-label>
          <input matInput formControlName="name" placeholder="Например, СО состава стали">
          <mat-icon matPrefix>title</mat-icon>
          @if (form.get('name')?.hasError('required') && form.get('name')?.touched) {
            <mat-error>Укажите наименование</mat-error>
          }
        </mat-form-field>

        <!-- Номер (регистрационный) -->
        <mat-form-field appearance="outline">
          <mat-label>Номер партии</mat-label>
          <input matInput formControlName="number" placeholder="Например, 22">
          <mat-icon matPrefix>confirmation_number</mat-icon>
          @if (form.get('number')?.hasError('required') && form.get('number')?.touched) {
            <mat-error>Укажите номер</mat-error>
          }
        </mat-form-field>

        <div class="grid">
          <mat-form-field appearance="outline">
            <mat-label>Чистота реактива</mat-label>
            <mat-select formControlName="purityTypeId">
              <!-- Пустая опция для сброса -->
              <mat-option [value]="null">— Не выбрано —</mat-option>

              @if (data.guide!.get('purity-reagent-type'); as types) {
                @for (entry of Array.from(types.entries()); track entry[0]) {
                  <mat-option [value]="entry[0]">{{ entry[1] }}</mat-option>
                }
              }
            </mat-select>
            <mat-icon matPrefix>category</mat-icon>
          </mat-form-field>

          @if (form.get('purityTypeId')?.value) {
            <mat-form-field appearance="outline">
              <mat-label>Изготовитель</mat-label>
              <input matInput formControlName="purityValue" placeholder="Например, 99.9 %">
              <mat-icon matPrefix>percent</mat-icon>
            </mat-form-field>
          }
        </div>

        <!-- Назначение -->
        <mat-form-field appearance="outline">
          <mat-label>Назначение</mat-label>
          <textarea matInput formControlName="purpose"
                    placeholder="Для градуировки приборов, контроля методик..."></textarea>
          <mat-icon matPrefix>description</mat-icon>
          @if (form.get('purpose')?.hasError('required') && form.get('purpose')?.touched) {
            <mat-error>Укажите назначение</mat-error>
          }
        </mat-form-field>

        <!-- Изготовитель -->
        <mat-form-field appearance="outline">
          <mat-label>Изготовитель</mat-label>
          <input matInput formControlName="producer" placeholder="Например, ФГУП «ВНИИМ»">
          <mat-icon matPrefix>factory</mat-icon>
        </mat-form-field>

        <!-- Условия применения -->
        <mat-form-field appearance="outline">
          <mat-label>Условия применения и хранения</mat-label>
          <textarea matInput formControlName="termsOfUse"
                    placeholder="Температура, влажность, особые условия..."></textarea>
        </mat-form-field>

        <div class="grid">
          <!-- Дата изготовления -->
          <mat-form-field appearance="outline">
            <mat-label>Дата изготовления</mat-label>
            <input
              matInput
              [matDatepicker]="produceDatePicker"
              formControlName="produceDate"
              placeholder="Выберите дату"
            />
            <mat-datepicker-toggle matSuffix [for]="produceDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #produceDatePicker></mat-datepicker>
            @if (form.get('produceDate')?.hasError('required') && form.get('produceDate')?.touched) {
              <mat-error>Укажите дату изготовления</mat-error>
            }
          </mat-form-field>

          <!-- Срок годности -->
          <mat-form-field appearance="outline">
            <mat-label>Срок годности до</mat-label>
            <input
              matInput
              [matDatepicker]="expirationDatePicker"
              formControlName="expirationDate"
              placeholder="Выберите дату"
            />
            <mat-datepicker-toggle matSuffix [for]="expirationDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #expirationDatePicker></mat-datepicker>
            @if (form.get('expirationDate')?.hasError('required') && form.get('expirationDate')?.touched) {
              <mat-error>Укажите срок годности</mat-error>
            }
          </mat-form-field>

          <div class="grid">
            <mat-form-field appearance="outline">
              <mat-label>Начальный остаток</mat-label>
              <input matInput type="number" step="0.001" formControlName="initialQuantity"/>
              @if (form.get('initialQuantity')?.hasError('required') && form.get('initialQuantity')?.touched) {
                <mat-error>Укажите количество</mat-error>
              }
              @if (form.get('initialQuantity')?.hasError('greaterThanZero')) {
                <mat-error>Количество должно быть больше 0</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Единица измерения</mat-label>
              <input matInput formControlName="unit" placeholder="мл, г, шт..."/>
              @if (form.get('unit')?.hasError('required') && form.get('unit')?.touched) {
                <mat-error>Укажите единицу измерения</mat-error>
              }
            </mat-form-field>
          </div>
        </div>


      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <app-button mat-dialog-close class="mr-20 error">
      Отмена
    </app-button>
    <app-button [disabled]="form.invalid" (click)="onSubmit()">
      {{ submitLabel }}
    </app-button>
  </mat-dialog-actions>
</div>
