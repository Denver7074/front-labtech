@if (info()) {
  <!-- Переключатель масштаба -->
  <div class="scale-selector">
    <button mat-button [class.active]="scaleMode() === 'MONTHLY'" (click)="onScaleChange('MONTHLY')">
      Месяцы
    </button>
    <button mat-button [class.active]="scaleMode() === 'WEEKLY'" (click)="onScaleChange('WEEKLY')">
      Недели
    </button>
  </div>

  <!-- Выбор года -->
  <div class="year-selector">
    <mat-form-field appearance="outline">
      <mat-select [value]="selectedYear()" (selectionChange)="onYearChange($event.value)">
        @for (year of years(); track year) {
          <mat-option [value]="year">{{ year }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Таблица -->
  <div class="maintenance-grid-container mat-elevation-z1">
    <table mat-table [dataSource]="gridData()" class="maintenance-grid">
      <!-- Оборудование -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Оборудование</th>
        <td mat-cell *matCellDef="let row">{{ row.equipment.name }}</td>
      </ng-container>

      <!-- Зав. № -->
      <ng-container matColumnDef="produceNumber">
        <th mat-header-cell *matHeaderCellDef>Зав. №</th>
        <td mat-cell *matCellDef="let row">{{ row.equipment.produceNumber }}</td>
      </ng-container>

      <!-- Колонка "Тип ТО" -->
      <ng-container matColumnDef="typeName">
        <th mat-header-cell *matHeaderCellDef>Тип ТО</th>
        <td mat-cell *matCellDef="let row" class="type-name-cell">
          @if (row.equipment.maintenances?.length) {
            @for (typeName of getUniqueTypeNamesWithDescriptions(row.equipment.maintenances); track typeName.name) {
              <div
                matTooltip="{{ typeName.description || 'Описание отсутствует' }}"
                matTooltipPosition="above"
                class="type-name-item">
                {{ typeName.name }}
              </div>
            }
          }
        </td>
      </ng-container>

      <!-- Месяцы -->
      @for (month of ['Янв','Фев','Мар','Апр','Май','Июн','Июл','Авг','Сен','Окт','Ноя','Дек']; track $index) {
        <ng-container [matColumnDef]="'month' + $index">
          <th mat-header-cell *matHeaderCellDef>{{ month }}</th>
          <td mat-cell *matCellDef="let row" class="maintenance-cell">{{ row.months[$index] }}</td>
        </ng-container>
      }

      <!-- Недели -->
      @for (week of weeks(); track $index; let i = $index) {
        <ng-container [matColumnDef]="'week' + i">
          <th mat-header-cell *matHeaderCellDef>{{ week.label }}</th>
          <td mat-cell *matCellDef="let row" class="maintenance-cell">{{ row.weeks[i] }}</td>
        </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns()"></tr>
    </table>
  </div>
} @else {
  <p class="no-data">Нет данных</p>
}
