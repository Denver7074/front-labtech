<div class="profile-page-container">
  <!-- Загрузка -->
  @if (isLoading()) {
    <div class="loading-spinner">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Загрузка профиля...</p>
    </div>
  }

  <!-- Ошибка -->
  @if (errorMessage() && !isLoading()) {
    <mat-error class="error-message">{{ errorMessage() }}</mat-error>
  }

  <!-- Профиль -->
  @if (personInfo()) {
    <div class="profile-grid">

      <!-- Карточка 1: Аватар + Основная информация -->
      <mat-card class="profile-card avatar-card">

        <div class="info-section">
          <h2>{{ getFullName() }}</h2>
          @if (getAge()) {
            <p class="age">Возраст: {{ getAge() }}</p>
          }

          <div class="detail-item">
            <strong>Имя:</strong> {{ personInfo()?.firstName }}
          </div>
          <div class="detail-item">
            <strong>Фамилия:</strong> {{ personInfo()?.lastName }}
          </div>
          @if (personInfo()?.middleName) {
            <div class="detail-item">
              <strong>Отчество:</strong> {{ personInfo()?.middleName }}
            </div>
          }
          <div class="detail-item">
            <strong>Дата рождения:</strong> {{ formatDate(personInfo()?.birthDate) }}
          </div>
          @if (personInfo()?.birthPlace) {
            <div class="detail-item">
              <strong>Место рождения:</strong> {{ personInfo()?.birthPlace }}
            </div>
          }
          @if (personInfo()?.snils) {
            <div class="detail-item">
              <strong>СНИЛС:</strong> {{ personInfo()?.snils }}
            </div>
          }

          <!-- Кнопки редактирования -->
<!--          @if (!isEditing()) {-->
<!--            <button mat-flat-button color="primary" (click)="toggleEdit()" class="edit-btn">-->
<!--              Редактировать-->
<!--            </button>-->
<!--          } @else {-->
<!--            <div class="form-actions">-->
<!--              <button mat-raised-button color="primary" (click)="toggleEdit()">-->
<!--                Сохранить-->
<!--              </button>-->
<!--              <button mat-stroked-button (click)="cancelEdit()">-->
<!--                Отмена-->
<!--              </button>-->
<!--            </div>-->
<!--          }-->
        </div>
      </mat-card>

      <!-- Карточка 3: Учеба -->
      <mat-card class="profile-card education-card">
        <mat-card-header>
          <mat-card-title>Учеба</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @if (personInfo()!.educations && personInfo()!.educations.length > 0) {
            @for (edu of personInfo()!.educations; track edu.documentNumber ?? edu.startDate) {
              <div class="detail-item education-item">
                <div><strong>{{ edu.organizationName }}</strong></div>
                <div>{{ edu.specialization }}</div>
                <div>{{ formatDate(edu.startDate) }} –
                  {{ edu.endDate ? formatDate(edu.endDate) : 'по настоящее время' }}
                </div>
                @if (edu.documentNumber) {
                  <div>Диплом №{{ edu.documentNumber }},
                    выдан {{ formatDate(edu.documentIssueDate ?? '') }}
                  </div>
                }
              </div>
            }
          } @else {
            <p>Данные об образовании отсутствуют</p>
          }
        </mat-card-content>
      </mat-card>

      <!-- Карточка 2: Контакты -->
      <mat-card class="profile-card contacts-card">
        <mat-card-header>
          <mat-card-title>Контакты</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @if (personInfo()!.contacts && personInfo()!.contacts.length > 0) {
            @for (contact of personInfo()!.contacts; track contact.value) {
              <div class="detail-item">
                <strong>{{ contact.contactTypeId }}:</strong> {{ contact.value }}
              </div>
            }
          } @else {
            <p>Контакты не указаны</p>
          }
        </mat-card-content>
      </mat-card>

      <!-- Карточка 4: Места работы -->
      <mat-card class="profile-card work-card">
        <mat-card-header>
          <mat-card-title>Места работы</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @if (personInfo()!.works && personInfo()!.works.length > 0) {
            @for (work of personInfo()!.works; track work.position + (work.startDate ?? '')) {
              <div class="detail-item work-item">
                <div><strong>{{ work.position }}</strong> в {{ work.organizationName }}</div>
                <div>{{ formatDate(work.startDate) }} –
                  {{ work.endDate ? formatDate(work.endDate) : 'по настоящее время' }}
                </div>
              </div>
            }
          } @else {
            <p>Опыт работы не указан</p>
          }
        </mat-card-content>
      </mat-card>

    </div>
  }
</div>
